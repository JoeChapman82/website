function setupButtons(){buttons=[],document.querySelectorAll("#homeScreenButton1, #homeScreenButton2, #homeScreenButton3, #homeScreenButton4").forEach(function(e,t){buttons.push({button:e,isOnFire:!1,rect:e.getBoundingClientRect()})})}function setup(){getStartingPositions(repositionableItems),canvas.height=window.innerHeight,canvas.width=window.innerWidth,bgCanvas.height=window.innerHeight,bgCanvas.width=window.innerWidth,horizontalUnit=canvas.width/worldWidth,verticalUnit=canvas.height/worldHeight,recalculatePositions(repositionableItems),generateRain(),generateStars(),generateMountains(),renderBackdrop(),renderStars(),generateTwinklingStars(),addKeyboardListeners(),addMouseListeners(),setupButtons()}function getStartingPositions(e){originalPositions=[],e.forEach(function(e){originalPositions.push({x:e.x/horizontalUnit,y:(canvas.height-e.y)/verticalUnit})})}function recalculatePositions(e){e.forEach(function(e,t){e.x=ww(originalPositions[t].x),e.y=wh(originalPositions[t].y)})}function ww(e){return e*horizontalUnit}function wh(e){return canvas.height-e*verticalUnit}function setDeltaTime(e){deltaTime=(e-lastTime)/1e3,lastTime=e,runTime+=deltaTime}function randomNumber(e,t){return Math.random()*(t-e)+e}function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height)}function ellipse(e,t,a,r,i,n){e.save(),e.beginPath(),e.translate(t-r,a-i),e.scale(r,i),e.arc(1,1,1,0,2*Math.PI,!1),e.restore(),e.fillStyle=n,e.fill()}function renderGround(){ctx.strokeStyle="#1A1710",ctx.lineWidth=5,ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(0,wh(1.75)),ctx.lineTo(ww(16),wh(1.75)),ctx.lineTo(canvas.width,canvas.height),ctx.lineTo(0,canvas.height),ctx.lineTo(0,wh(2)),ctx.stroke(),ctx.fillStyle="#1A1710",ctx.fill(),ctx.closePath()}function renderHedges(){ctx.fillStyle="#003c00";for(var e=0;25*e<canvas.width+25;e++)ctx.beginPath(),ctx.arc(25*e,wh(1.9),20,0,twoPi),ctx.fill();ctx.fillStyle="#002800";for(var t=0;25*t<canvas.width+25;t++)ctx.beginPath(),ctx.arc(25*t,wh(1.9),15,0,twoPi),ctx.fill();ctx.rect(0,wh(1.9),canvas.width,20),ctx.fill()}function generateMountains(){var e=0,t=5;for((mountains=[]).push({x:e,y:t});e<16;)e+=Math.random()/10,t=Math.random()>.5&&t<5?t+Math.random()/10:t>4?t-Math.random()/10:t+Math.random()/10,mountains.push({x:e,y:t})}function renderMountains(){ctx.strokeStyle="#0C0D09",ctx.fillStyle="#0C0D09",ctx.beginPath(),ctx.moveTo(ww(0),wh(4)),ctx.lineTo(ww(0),wh(4));for(var e=0;e<mountains.length;e++)ctx.lineTo(ww(mountains[e].x),wh(mountains[e].y));ctx.lineTo(canvas.width,canvas.height),ctx.lineTo(0,canvas.height),ctx.lineTo(0,wh(4)),ctx.stroke(),ctx.fill(),ctx.closePath()}function renderTree(){ctx.drawImage(tree,ww(11),wh(4.75),300,350)}function renderTent(){ctx.drawImage(tent,ww(6.5),wh(4),233,295)}function FireParticle(e,t,a,r){this.x=e,this.y=t,this.vx=a,this.vy=r,this.life=0}function updateFire(){for(var e=0;e<8;e++)fireParticles.push(new FireParticle(ww(2),wh(1),(2*Math.random()*fireSpeed-fireSpeed)/2,0-2*Math.random()*fireSpeed)),mouse.isOnFire&&fireParticles.push(new FireParticle(mouse.x,mouse.y,(2*Math.random()*fireSpeed-fireSpeed)/2,0-2*Math.random()*fireSpeed));for(var t=0;t<4;t++)buttons.forEach(function(e){e.isOnFire&&fireParticles.push(new FireParticle(e.rect.x,e.rect.y,(2*Math.random()*fireSpeed-fireSpeed)/2,0-2*Math.random()*fireSpeed),new FireParticle(e.rect.x+e.rect.width,e.rect.y,(2*Math.random()*fireSpeed-fireSpeed)/2,0-2*Math.random()*fireSpeed))});for(var a=0;a<fireParticles.length;a++)fireParticles[a].x+=fireParticles[a].vx,fireParticles[a].y+=fireParticles[a].vy,fireParticles[a].life++,fireParticles[a].life>=maxFireParticles&&(fireParticles.splice(a,1),a--)}function renderFire(){ctx.globalCompositeOperation="lighter";for(var e=0;e<fireParticles.length;e++)ctx.fillStyle="rgba("+(260-2*fireParticles[e].life)+","+(2*fireParticles[e].life+50)+","+2*fireParticles[e].life+","+(maxFireParticles-fireParticles[e].life)/maxFireParticles*.4+")",ctx.beginPath(),ctx.arc(fireParticles[e].x,fireParticles[e].y,(maxFireParticles-fireParticles[e].life)/maxFireParticles*(fireParticleSize/2)+fireParticleSize/2,0,2*Math.PI),ctx.fill();ctx.globalCompositeOperation="source-over"}function renderFireBase(){var e=ctx.createRadialGradient(ww(2),wh(0),200,ww(2),ww(1),200);e.addColorStop(0,"rgba(225, 225, 224, 0.1)"),e.addColorStop(1,"rgba(225, 225, 0, 0.05)"),ellipse(ctx,ww(2),wh(1),150,40,e),ellipse(ctx,ww(2),wh(1),200,50,"rgba(255, 255, 255, 0.05)"),ctx.fillStyle="#8B8D7A",ctx.strokeStyle="black",ctx.lineWidth=1;for(var t=0;t<stones.length;t++)ctx.beginPath(),ellipse(ctx,ww(stones[t].x),wh(stones[t].y),0===t?17:15,0===t?8:7,"#8B8D7A"),ctx.fill(),ctx.stroke()}function renderBackdrop(){var e=bgCtx.createLinearGradient(0,0,0,canvas.height-100);e.addColorStop(0,"#00111e"),e.addColorStop(1,"#04263d"),bgCtx.fillStyle=e,bgCtx.fillRect(0,0,canvas.width,canvas.height)}function generateStars(){stars=[];for(var e=0;e<starsAmount;e++)stars.push({x:randomNumber(0,canvas.width),y:randomNumber(0,canvas.height/2),size:1})}function generateTwinklingStars(){twinklingStars=[];for(var e=0;e<twinklingStarsAmount;e++)twinklingStars.push({x:randomNumber(0,canvas.width),y:randomNumber(0,canvas.height/2),size:1,opacity:0,increasing:!0})}function generateShootingStars(){randomNumber(0,2e3)>1980&&shootingStars.push({x:randomNumber(0,canvas.width),y:randomNumber(0,canvas.height/3),vx:20*Math.random()-10,vy:randomNumber(1,3),size:1*Math.random(),decay:2*Math.random()+.5,opacity:.2,color:"255,235,255"})}function renderStars(){for(var e=0;e<stars.length;e++){var t=stars[e];bgCtx.beginPath(),bgCtx.shadowBlur=Math.floor(5*Math.random()+2),bgCtx.shadowColor="white",bgCtx.fillStyle="rgba(255, 255, 255,"+Math.random()+")",bgCtx.fillRect(t.x,t.y,t.size,t.size),bgCtx.closePath()}}function renderTwinklingStars(){for(var e=0;e<twinklingStars.length;e++){var t=twinklingStars[e];t.opacity=t.increasing?t.opacity+.01:t.opacity-.01,ctx.beginPath(),ctx.shadowBlur=Math.floor(5*Math.random()+5),ctx.shadowColor="white",ctx.fillStyle="rgba(255, 255, 255,"+t.opacity+")",ctx.arc(t.x,t.y,t.size,0,2*Math.PI),ctx.fill(),ctx.closePath(),(t.opacity>1||t.opacity<0||Math.random()>.95)&&(t.increasing=!t.increasing)}ctx.shadowBlur=0}function renderShootingStars(){for(var e=0;e<shootingStars.length-1;e++){var t=shootingStars[e];if(void 0!==t&&t.decay>0){for(var a=0;a<shootingStarTrail;a++)ctx.beginPath(),ctx.fillStyle="rgba("+t.color+","+(e=t.opacity*(1-e/shootingStarTrail))+")",ctx.arc(t.x-t.vx*e,t.y-t.vy*e,1,0,2*Math.PI),ctx.fill(),ctx.closePath();t.decay-=.01,t.x+=t.vx,t.y+=t.vy,t.decay<1?t.opacity-=.01:t.opacity<1&&(t.opacity+=.05)}else shootingStars.splice(e,1)}}function generateRain(){rainParticles=[];for(var e=0;e<maxRainParticles;e++)rainParticles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,height:1*Math.random(),vx:4*Math.random()-4+2,vy:10*Math.random()+10})}function renderRain(){for(var e=0;e<rainParticles.length;e++){var t=rainParticles[e];ctx.beginPath(),ctx.strokeStyle="rgba(174, 194, 224, 0.5)",ctx.lineWidth=1,ctx.lineCap="round",ctx.moveTo(t.x,t.y),ctx.lineTo(t.x+t.height*t.vx,t.y+t.height*t.vy),ctx.stroke()}}function updateRain(){for(var e=0;e<rainParticles.length;e++){var t=rainParticles[e];t.x+=t.vx,t.y+=t.vy,(t.x>canvas.width||t.y>canvas.height)&&(t.x=Math.random()*canvas.width,t.y=-20)}}function updateCharacter(){if(upPressed&&!character.isJumping&&(character.activeState="jumping",character.isJumping=!0,character.jumping.currentFrame=0),character.isJumping)return rightPressed?(character.isFacingForwards=!0,character.activeState="jumping",character.x+=character.walking.vx):leftPressed&&(character.isFacingForwards=!1,character.activeState="jumpingReverse",character.x-=character.walking.vx),character.jumpTimer+=deltaTime,character.jumpTimer<character.jumpTime/2?character.y-=character.jumping.vy:character.y+=character.jumping.vy,void(character.jumpTimer>character.jumpTime&&(character.activeState=character.isFacingForwards?"idle":"idleReverse",character.isJumping=!1,character.jumpTimer=0));rightPressed?(character.isFacingForwards=!0,character.activeState="walking",character.isJumping=!1,character.x+=character.walking.vx):leftPressed?(character.isFacingForwards=!1,character.activeState="walkingReverse",character.x-=character.walking.vx):(character.idle.idleFor="idle"!==character.activeState?0:character.idle.idleFor+=deltaTime,character.activeState=character.idle.idleFor>60?"sleeping":character.activeState,character.activeState="sleeping"===character.activeState?"sleeping":character.isFacingForwards?"idle":"idleReverse")}function renderCharacter(){ctx.drawImage(character[character.activeState].image,character[character.activeState].currentFrame*character[character.activeState].fullwidth/character[character.activeState].frames,0,character[character.activeState].fullwidth/character[character.activeState].frames,character[character.activeState].fullHeight,character.x,character.y,character[character.activeState].width,character[character.activeState].height),character[character.activeState].displayedFor++,character[character.activeState].displayedFor===character[character.activeState].framesPerImage&&(character[character.activeState].displayedFor=0,character[character.activeState].currentFrame=++character[character.activeState].currentFrame%character[character.activeState].frames),"sleeping"===character.activeState&&renderCharacterThoughts()}function renderCharacterThoughts(){var e=character.x,t=character.y-character.height/4-thoughtBubbleHeight;thoughtBubbleHeight=(isThoughtBubbleHeightIncreasing=thoughtBubbleHeight<=30&&thoughtBubbleHeight>=0?isThoughtBubbleHeightIncreasing:!isThoughtBubbleHeightIncreasing)?thoughtBubbleHeight+=.5:thoughtBubbleHeight-=.5;var a=[character.y+character.height/2,character.y+character.height/2.5-thoughtBubbleHeight/2,character.y+character.height/4-thoughtBubbleHeight];ctx.strokeStyle="black",ctx.fillStyle="rgba(255, 255, 255, 0.3)";for(var r=0;r<a.length;r++)ctx.beginPath(),ctx.arc(r%2==0?character.x+character.width/3:character.x+character.width/3+10,a[r],5+5*r,0,twoPi),ctx.stroke(),ctx.fill();ctx.beginPath(),ctx.moveTo(e,t),ctx.bezierCurveTo(e-40,t+20,e-40,t+70,e+60,t+70),ctx.bezierCurveTo(e+80,t+100,e+150,t+100,e+170,t+70),ctx.bezierCurveTo(e+250,t+70,e+250,t+40,e+220,t+20),ctx.bezierCurveTo(e+260,t-40,e+200,t-50,e+170,t-30),ctx.bezierCurveTo(e+150,t-75,e+80,t-60,e+80,t-30),ctx.bezierCurveTo(e+30,t-75,e-20,t-60,e,t),ctx.fill(),ctx.fillStyle="black",ctx.textAlign="center",ctx.font=thoughtFontHeight+"px Comic Sans MS";for(var i=0;i<thoughtMessages[activeThought].length;i++)ctx.fillText(thoughtMessages[activeThought][i],e+110,t+i*thoughtFontHeight)}function basicAI(){mouse.isOnFire&&isCollidingMouseRect(character)&&(mouse.x<character.x+character.width/2?(rightPressed=!0,setTimeout(function(){rightPressed=!1},500)):(leftPressed=!0,setTimeout(function(){leftPressed=!1},500)))}function isCollidingMouseRect(e){return mouse.x>=e.x&&mouse.x<=e.x+e.width&&mouse.y>=e.y&&mouse.y<=e.y+e.height}function keepCharacterInBounds(){character.x=character.x<canvas.width-150?character.x:canvas.width-150,character.x=character.x>0?character.x:0,character.y=character.y<550?character.y:550}function handleMousePointer(){isCollidingMouseRect(fireHitBox)?document.body.style.cursor="pointer":document.body.style.cursor="auto"}function setFire(){mouse.isOnFire&&buttons.forEach(function(e){e.isOnFire||(e.isOnFire=isCollidingMouseRect(e.rect))})}function addKeyboardListeners(){keyDownListeners(),keyUpListeners()}function addMouseListeners(){document.addEventListener("mousemove",getMousePosition),document.addEventListener("mousedown",mouseDown),document.addEventListener("mouseup",mouseUp)}function addTouchListeners(){document.addEventListener("touchmove",getTouchPosition),canvas.addEventListener("touchstart",touchDown,!1),document.addEventListener("touchend",touchUp)}function getTouchPosition(e){var t=e.touches[0],a=canvas.getBoundingClientRect(),r=document.documentElement;mouse.x=t.clientX-a.left-r.scrollLeft,mouse.y=t.clientY-a.top-r.scrollTop}function touchDown(e){e.preventDefault(),console.log(e);var t=e.touches[0],a=canvas.getBoundingClientRect(),r=document.documentElement;mouse.x=t.clientX-a.left-r.scrollLeft,mouse.y=t.clientY-a.top-r.scrollTop,mouse.isOnFire=isCollidingMouseRect(fireHitBox)}function touchUp(){mouse.isOnFire=!1}function mouseDown(){mouse.isOnFire=isCollidingMouseRect(fireHitBox)}function mouseUp(){mouse.isOnFire=!1}function getMousePosition(e){var t=canvas.getBoundingClientRect(),a=document.documentElement;mouse.x=e.clientX-t.left-a.scrollLeft,mouse.y=e.clientY-t.top-a.scrollTop}function keyDownListeners(){document.addEventListener("keydown",function(e){39===e.keyCode?rightPressed=!0:37===e.keyCode?leftPressed=!0:38===e.keyCode?(e.preventDefault(),upPressed=!0):40===e.keyCode?(e.preventDefault(),downPressed=!0):32===e.keyCode?(e.preventDefault(),spacePressed=!0):80===e.keyCode&&pause()})}function keyUpListeners(){document.addEventListener("keyup",function(e){39===e.keyCode?rightPressed=!1:37===e.keyCode?leftPressed=!1:38===e.keyCode?upPressed=!1:40===e.keyCode?downPressed=!1:32===e.keyCode&&(e.preventDefault(),spacePressed=!1)})}function draw(e){setDeltaTime(e),clearCanvas(),generateShootingStars(),renderTwinklingStars(),renderShootingStars(),renderMountains(),renderGround(),renderHedges(),renderTree(),renderTent(),renderFireBase(),updateFire(),renderFire(),setFire(),handleMousePointer(),basicAI(),updateCharacter(),keepCharacterInBounds(),renderCharacter(),animation=requestAnimationFrame(draw)}var bgCanvas=document.getElementById("timescapeBackgroundCanvas"),bgCtx=bgCanvas.getContext("2d"),canvas=document.getElementById("timescapeForegroundCanvas"),ctx=canvas.getContext("2d"),lastTime=0,deltaTime=0,runTime=0,worldWidth=16,worldHeight=9,horizontalUnit=0,verticalUnit=0,upPressed=!1,downPressed=!1,rightPressed=!1,leftPressed=!1,spacePressed=!1,twoPi=2*Math.PI,mouse={x:0,y:0,isOnFire:!1},buttons=[],repositionableItems=[],originalPositions=[],starsAmount=1e3,twinklingStarsAmount=75,shootingStarTrail=3,stars=[],twinklingStars=[],shootingStars=[],fireParticles=[],maxFireParticles=30,fireSpeed=2,fireParticleSize=10,rainParticles=[],maxRainParticles=1e3,stones=[{x:2,y:.83},{x:2.25,y:.93},{x:1.75,y:.93},{x:1.85,y:1.08},{x:2.15,y:1.08}],mountains=[],hedges=[],tree=new Image;tree.src="/images/tree.png";var tent=new Image;tent.src="/images/tent.png";var thoughtBubbleHeight=0,isThoughtBubbleHeightIncreasing=!0,thoughtMessages=[["This site gives","free cookies.","Nom nom nom"]],activeThought=0,thoughtFontHeight=24;setup();var character={x:ww(5),y:wh(3),width:176,height:212,activeState:"sleeping",isFacingForwards:!0,isJumping:!1,jumpTimer:0,jumpTime:1,walking:{image:new Image,frames:10,framesPerImage:6,fullwidth:1860,fullHeight:222,width:176,height:212,currentFrame:0,displayedFor:0,vx:4},walkingReverse:{image:new Image,frames:10,framesPerImage:6,fullwidth:1860,fullHeight:222,width:176,height:212,currentFrame:0,displayedFor:0,vx:4},jumping:{image:new Image,frames:10,framesPerImage:7,fullwidth:1760,fullHeight:212,width:176,height:212,currentFrame:0,displayedFor:0,vy:4},jumpingReverse:{image:new Image,frames:10,framesPerImage:7,fullwidth:1760,fullHeight:212,width:176,height:212,currentFrame:0,displayedFor:0,vy:4},idle:{image:new Image,frames:10,framesPerImage:7,fullwidth:1760,fullHeight:212,width:176,height:212,currentFrame:0,displayedFor:0,idleFor:0},idleReverse:{image:new Image,frames:10,framesPerImage:7,fullwidth:1760,fullHeight:212,width:176,height:212,currentFrame:0,displayedFor:0,idleFor:0},sleeping:{image:new Image,frames:1,framesPerImage:7,fullwidth:283,fullHeight:225,width:283,height:225,currentFrame:0,displayedFor:0}};character.sleeping.image.src="/images/sleeping.png",character.walking.image.src="/images/walking.png",character.walkingReverse.image.src="/images/walkingReverse.png",character.idle.image.src="/images/idle.png",character.idleReverse.image.src="/images/idleReverse.png",character.jumping.image.src="/images/jumping.png",character.jumpingReverse.image.src="/images/jumpingReverse.png";var fireHitBox={x:ww(1.75),y:wh(1.35),width:50,height:50};repositionableItems.push(character),repositionableItems.push(fireHitBox),window.addEventListener("resize",function(){cancelAnimationFrame(animation),setup(),animation=requestAnimationFrame(draw)}),window.addEventListener("orientationchange",function(){cancelAnimationFrame(animation),setup(),animation=requestAnimationFrame(draw)}),animation=requestAnimationFrame(draw);