!function(){function e(){t(),i(),C=0,W=M}function t(){S=y.getBoundingClientRect(),v=S.width/F,p=S.height/B,Z=(k=~~(F/I))/7.5,_=k/10,i()}function n(e){return e*k}function i(){A=[];for(var e=0;e<I;e++){var t=!1;A[e]=[];for(var i=0;i<I;i++){var r=!1;e>1&&A[e-1][i].img===A[e-2][i].img&&(t=A[e-1][i].img),i>1&&A[e][i-1].img===A[e][i-2].img&&(r=A[e][i-1].img);for(var o=l(0,$.length);!1!==r&&o===r||!1!==t&&o===t;)o=l(0,$.length);A[e].push({x:n(e),y:n(i),img:o})}}}function r(){if(G)h();else{for(var e=!1,t=0;t<A.length;t++){if(A[t].length!==A.length)for(var i=A.length-A[t].length,r=0;r<i;r++)A[t].unshift({x:n(t),y:n(-(r+1)),img:l(0,$.length)});for(var o=0;o<A[t].length;o++)A[t][o].x!==n(t)&&(A[t][o].x+=A[t][o].x>n(t)?-_:_,A[t][o].x=parseFloat(A[t][o].x.toFixed(2)),e=!0),A[t][o].y!==n(o)&&(A[t][o].y+=A[t][o].y>n(o)?-_:_,A[t][o].y=parseFloat(A[t][o].y.toFixed(2)),e=!0)}if(e)z=!1,N=0;else{var f=g();!function(e){if(!ie)return;0===e.length&&re<1?(re++,P.reverse(),x()):c()}(f),f.length>0?function(e){for(var t=[],i=0;i<e.length;i++)0===t.filter(function(t){return t.x===e[i].x&&t.y===e[i].y}).length&&(te.push({x:n(e[i].x),y:n(e[i].y),colour:ee[A[e[i].x][e[i].y].img],existedFor:0}),A[e[i].x].splice(e[i].y,1),t.push({x:e[i].x,y:e[i].y}));C+=e.length*L*R}(f):(R=1,z||(z=a()))}}}function o(e,t,n){m.lineWidth=5,m.strokeStyle=n,m.beginPath(),m.moveTo(e,t),m.lineTo(e+k/5,t),m.moveTo(e,t),m.lineTo(e,t+k/5),m.moveTo(e+k,t),m.lineTo(e+k-k/5,t),m.moveTo(e+k,t),m.lineTo(e+k,t+k/5),m.moveTo(e,t+k),m.lineTo(e,t+k-k/5),m.moveTo(e,t+k),m.lineTo(e+k/5,t+k),m.moveTo(e+k,t+k),m.lineTo(e+k-k/5,t+k),m.moveTo(e+k,t+k),m.lineTo(e+k,t+k-k/5),m.stroke(),m.lineWidth=1}function l(e,t){return~~(Math.random()*(t-e))+e}function g(){var e=[];return e=e.concat(function(){for(var e=[],t=0;t<A.length;t++)for(var n=1,i=!1,r=0;r<A[t].length;r++)n=A[t][r].img===i?++n:1,i=A[t][r].img,3===n&&e.push({x:t,y:r-2},{x:t,y:r-1},{x:t,y:r}),4===n&&e.push({x:t,y:r}),5===n&&e.push({x:t,y:r});return e}()),(e=e.concat(function(){for(var e=[],t=0;t<A.length;t++)for(var n=1,i=!1,r=0;r<A.length;r++)n=A[r][t].img===i?++n:1,i=A[r][t].img,3===n&&e.push({x:r-2,y:t},{x:r-1,y:t},{x:r,y:t}),4===n&&e.push({x:r,y:t}),5===n&&e.push({x:r,y:t});return e}())).sort(function(e,t){return t.y<e.y?-1:t.y>e.y?1:0}),e}function a(){for(var e=!1,t=0,n=l(0,A.length);t<A.length;n=(n+1)%A.length){t++;for(var i=0;i<A.length;i++)for(var r=A[n][i],o=[{x:n-1,y:i,condition:0!==n,direction:"left"},{x:n+1,y:i,condition:n!==A.length-1,direction:"right"},{x:n,y:i-1,condition:0!==i,direction:"up"},{x:n,y:i+1,condition:i!==A.length-1,direction:"down"}],a=0;a<4;a++)if(o[a].condition&&!e&&(A[n][i]=A[o[a].x][o[a].y],A[o[a].x][o[a].y]=r,matches=g(),e=matches.length>0&&A[matches[0].x][matches[0].y].img===r.img&&A[matches[1].x][matches[1].y].img===r.img&&A[matches[2].x][matches[2].y].img===r.img,A[o[a].x][o[a].y]=A[n][i],A[n][i]=r,e))return{x:n,y:i,direction:o[a].direction}}if(!e)return h(),!1}function h(){G=!0,oe=!0;for(var e=!0,t=F/2-n(.5),i=B/2-n(.5),r=0;r<A.length;r++)for(var o=0;o<A.length;o++)(A[r][o].x>t+_||A[r][o].x<t-_)&&(A[r][o].x+=A[r][o].x>t?-_:_,A[r][o].x=parseFloat(A[r][o].x.toFixed(2)),e=!1),(A[r][o].y>i+_||A[r][o].y<i-_)&&(A[r][o].y+=A[r][o].y>i?-_:_,A[r][o].y=parseFloat(A[r][o].y.toFixed(2)),e=!1);e&&(A.forEach(function(e){e.forEach(function(e){e.img=l(0,$.length)})}),T=!0,setTimeout(function(){oe=!1,T=!1,G=!1,d=requestAnimationFrame(f)},500))}function c(){P.length=0,ie=!1,re=0}function x(){var e=[A[P[0].x][P[0].y],A[P[1].x][P[1].y]];Math.abs(P[0].x-P[1].x)+Math.abs(P[0].y-P[1].y)<=1?(A[P[0].x][P[0].y]=e[1],A[P[1].x][P[1].y]=e[0],ie=!0):P.shift()}function f(t){!function(e){w=e-b<250?(e-b)/1e3:.0167,b=e}(t),N+=w,(W-=w)<0&&e(),m.clearRect(0,0,F,B),s.clearRect(0,0,u.width,u.height),q&&(D+=w)>=H&&z&&(D=0,1===P.length?(P[0]={x:z.x,y:z.y},P[1]={x:"left"===z.direction?z.x-1:"right"===z.direction?z.x+1:z.x,y:"up"===z.direction?z.y-1:"down"===z.direction?z.y+1:z.y},x()):P[0]={x:z.x,y:z.y}),r(),function(){for(var e=te.length-1;e>=0;e--)te[e].existedFor+=w,te[e].existedFor>=ne&&te.splice(e,1)}(),s.drawImage(X,0,0,u.width,u.height),function(){for(var e=["rgba(128, 128, 128, 0.95)","rgba(169, 169, 169, 0.95)"],t=0;t<A.length;t++)for(var i=0;i<A.length;i++)m.fillStyle=i+t&1?e[1]:e[0],m.fillRect(n(t),n(i),k,k)}(),function(){for(var e=0;e<te.length;e++)m.beginPath(),m.fillStyle=te[e].colour,m.rect(te[e].x,te[e].y,k,k),m.fill()}(),function(){m.strokeStyle="black",m.textAlign="center",m.lineWidth=5,m.textBaseline="middle";for(var e=0;e<A.length;e++)for(var t=0;t<A[e].length;t++)m.beginPath(),!1!==z&&z.x===e&&z.y===t&&N>j&&o(A[e][t].x,A[e][t].y,"red"),1===P.length&&P[0].x===e&&P[0].y===t&&o(A[e][t].x,A[e][t].y,"yellow"),m.drawImage($[A[e][t].img],A[e][t].x+Z,A[e][t].y+Z,k-2*Z,k-2*Z),m.fill(),m.stroke()}(),s.beginPath(),s.fillStyle="rgba(169, 0, 0, 1)",s.textBaseline="hanging",s.textAlign="center",s.fillText("Score: "+C,u.width/2,10),oe&&(m.beginPath(),m.font="Bold 42px Arial Black",m.fillStyle="black",m.textAlign="center",m.textBaseline="hanging",m.fillText("No available moves",F/2,50),m.fill()),function(){var e=W/M*120,t=(u.width-20)*(W/M);s.fillStyle="rgba(188, 188, 188, 0.6)",s.beginPath(),s.rect(10,u.height-50,u.width-20,30),s.fill(),s.fillStyle="hsl("+e+", 100%, 50%)",s.beginPath(),s.rect(10,u.height-50,t,30),s.fill(),s.beginPath(),s.textAlign="center",s.textBaseline="bottom",s.fillText("Time: "+W.toFixed(),u.width/2,u.height-50)}(),T||(d=requestAnimationFrame(f))}var y=document.getElementById("matchThreeCanvasGrid"),m=y.getContext("2d"),u=document.getElementById("matchThreeCanvas"),s=u.getContext("2d");s.font="Bold 42px Arial Black";var d,v,p,b=0,w=0,T=!1,F=y.width,B=y.height,I=8,k=0,A=[],E=!1,S=0,P=[],_=0,C=0,L=50,R=1,q=!0,z=!1,M=60,W=0,G=!1,N=0,j=5,D=0,H=1,J=new Image,K=new Image,O=new Image,Q=new Image,U=new Image,V=new Image,X=new Image,Y="/images/games/puzzle/match-three/",Z=0;J.src=Y+"blue-gems/blue_01.png",K.src=Y+"green-gems/green_02.png",O.src=Y+"pink-gems/pink_03.png",Q.src=Y+"purple-gems/purple_04.png",U.src=Y+"red-gems/red_05.png",V.src=Y+"yellow-gems/yellow_06.png",X.src=Y+"bg.png";var $=[J,K,O,Q,U,V],ee=["rgba(150, 150, 255, 0.4)","rgba(0, 255, 0, 0.4)","rgba(255, 192, 203, 0.6)","rgba(128, 0, 128, 0.4)","rgba(255, 0, 0, 0.4)","rgba(255, 255, 0, 0.4)"],te=[],ne=.8,ie=!1,re=0,oe=!1;e(),d=requestAnimationFrame(f),window.addEventListener("resize",t),y.addEventListener("mousedown",function(e){E=!0;var t=~~((e.x-S.x)/(k*v)),n=~~((e.y-S.y)/(k*p));return P.push({x:t,y:n}),2===P.length&&x()}),y.addEventListener("mouseup",function(e){if(!ie)return E=!1,2===P.length&&x()}),y.addEventListener("mousemove",function(e){if(E&&!(P.length<1)){var t=~~((e.x-S.x)/(k*v)),n=~~((e.y-S.y)/(k*p));t!==P[0].x||n!==P[0].y?(P[1]={x:t,y:n},x(),E=!1):P.length=1}}),y.addEventListener("mouseout",c)}();