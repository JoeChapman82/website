!function(){"use strict";var e,t=document.getElementById("canvas"),n=t.getContext("2d"),i=document.getElementById("fileInput"),o=(document.getElementById("controlsWrapper"),1),r=100,a=100,l=10,d="demo",c=!1,s="Choose an audio file below",u=!0,h={circular:function(){return function(){var e=.66*w-a;n.lineWidth=2,y.getByteFrequencyData(B),n.save(),n.translate(t.width/2,t.height/2),n.rotate(270*Math.PI/180);for(var i=a;i<e;i++){var o=B[i]<l?l:B[i];o*=c?.5:.8,n.rotate(2*Math.PI/(e-a)),n.beginPath(),n.strokeStyle="rgba(0, 0, 255, .8)",n.moveTo(r,0),n.lineTo(r+o,0),n.stroke(),n.closePath(),n.beginPath(),n.strokeStyle="rgba(173, 216, 230, .15)",n.moveTo(r,0),n.lineTo(r+o/3,0),n.stroke(),n.closePath()}n.restore()}(),P(),void I()},linear:function(){(function(){var i=0;n.fillStyle="rgba(173, 216, 230, .15)",y.getByteFrequencyData(B);for(var o=0;o<w;o++){var r=B[o];n.fillRect(i,.835*t.height-r,e,r),i+=e+1}})()},demo:function(){return function(){n.lineWidth=2,n.save(),n.translate(t.width/2,t.height/2),n.rotate(270*Math.PI/180);for(var e=0;e<150;e++)n.rotate(2*Math.PI/150),n.beginPath(),n.strokeStyle="rgba(0, 0, 255, .8)",n.moveTo(r,0),n.lineTo(r+10,0),n.stroke(),n.closePath(),n.beginPath(),n.strokeStyle="rgba(173, 216, 230, .15)",n.moveTo(r,0),n.lineTo(r+10/3,0),n.stroke(),n.closePath();n.restore()}(),P(),void I()},chaos:function(){return function(){n.fillStyle="red",n.strokeStyle="red",n.lineWidth=2,y.getByteFrequencyData(B),n.save(),n.translate(t.width/2,t.height/2);for(var e=0;e<w;e++){var i=B[e];i*=c?.5:.8;var o=e/(w/2)*Math.PI;n.beginPath(),n.rotate(2*Math.PI*o),n.moveTo(100,0),n.lineTo(100+i,0),n.stroke(),n.closePath()}n.restore()}(),void I()},concentric:function(){(function(){var e=.66*w-a;n.lineWidth=1,y.getByteFrequencyData(B);for(var i=0,o=a;o<e;o++){var r=B[o]<5?5:B[o];r*=c?.5:1,n.beginPath(),n.strokeStyle="rgba(0, 0, 255, .3)",n.beginPath(),n.arc(i,t.height/2,r,0,2*Math.PI),n.stroke(),n.closePath(),i+=t.width/(e-a)}})()}},g=["circular","linear","chaos","concentric"],m=[0,1,2,3],f=0,v=new(window.AudioContext||window.webkitAudioContext),y=v.createAnalyser();y.fftSize=1024;var w=y.frequencyBinCount,B=new Uint8Array(w),b=document.getElementById("audioElement");function k(){t.width=window.innerWidth,t.height=window.innerHeight-50,o=t.width/900,r=t.width>t.height?t.height/4:t.width/4,c=t.width>t.height?2*r+255>t.height:2*r+255>t.width,e=t.width/w,n.font="24px Arial",n.textAlign="center",n.textBaseline="middle"}function I(){n.lineWidth=1;var e=.3*r;n.font=e+"px Arial",n.fillStyle=2!==f?"rgba(173, 216, 230, .2)":"rgba(43, 16, 30, .2)";var i=u?L(b.currentTime):isNaN(b.duration)?"0:00":L(b.duration-b.currentTime);n.beginPath(),n.fillText(i,t.width/2,t.height/2)}function P(){var e=b.currentTime/b.duration*360;n.beginPath(),n.strokeStyle="rgba(255, 255, 255, .2)",n.arc(t.width/2,t.height/2,.55*r,0,2*Math.PI),n.stroke(),n.beginPath(),n.arc(t.width/2,t.height/2,.8*r,0,2*Math.PI),n.stroke(),n.beginPath(),n.strokeStyle="rgba(173, 216, 230, 0.05)",n.lineWidth=.25*r,n.arc(t.width/2,t.height/2,.675*r,0,e*(Math.PI/180)),n.stroke()}function E(){n.lineWidth=2;var e=o>1?30*o:40*o;n.font=e+"px Arial",n.fillStyle=2!==f?"rgba(177, 177, 177, .5)":"rgba(44, 44, 44, .5)",n.beginPath(),n.fillText(s,t.width/2,35)}function L(e){var t=Math.floor(e/60).toString(),n=Math.floor(e%60).toString();return t+":"+(n=1===n.length?"0"+n:n)}function S(){document.getElementById("audioVisualiserControls").classList.add("js-hidden"),document.getElementById("audioVisualiserOpenButton").classList.remove("js-hidden")}d="circular",v.createMediaElementSource(b).connect(y),y.connect(v.destination),k(),i.onchange=function(){var e,t=this.files;URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(t[0]),e=t[0].name,s=e.slice(0,e.lastIndexOf(".")),b.load(),d="demo"===d?"circular":d,b.play()},function e(){n.clearRect(0,0,t.width,t.height),h[d](),E(),requestAnimationFrame(e)}(),window.addEventListener("resize",k),document.getElementById("audioVisualiserOpenButton").addEventListener("click",function(){this.classList.add("js-hidden"),document.getElementById("audioVisualiserControls").classList.remove("js-hidden")}),document.getElementById("audioVisualiserCloseButton").addEventListener("click",S),document.getElementById("audioVisualiserModeButton").addEventListener("click",function(){d=g[(g.indexOf(d)+1)%g.length]}),document.getElementById("audioVisualiserBackgroundButton").addEventListener("click",function(){document.getElementById("audioVisualiserBackground").classList.remove("audio-visualiser-bg-"+f),f=(f+1)%m.length,document.getElementById("audioVisualiserBackground").classList.add("audio-visualiser-bg-"+f)}),document.getElementById("audioVisualiserTimerButton").addEventListener("click",function(){u=!u}),document.addEventListener("click",function(e){return!document.getElementById("audioVisualiserControls").contains(e.target)&&S()},!0),document.getElementById("fileInput").addEventListener("click",function(){var e=document.getElementById("audioVisualiserWrapper"),t=e.requestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;try{t.call(e)}catch(e){console.log("no full screen")}})}();