!function(){"use strict";var e,t=document.getElementById("canvas"),i=t.getContext("2d"),n=document.getElementById("fileInput"),a=(document.getElementById("controlsWrapper"),1),o=100,r=100,d=10,l="demo",c=!1,s="Choose an audio file below",u=!0,h={circular:function(){return function(){var e=.66*w-r;i.lineWidth=2,y.getByteFrequencyData(b),i.save(),i.translate(t.width/2,t.height/2),i.rotate(270*Math.PI/180);for(var n=r;n<e;n++){var a=b[n]<d?d:b[n];a*=c?.5:.8,i.rotate(2*Math.PI/(e-r)),i.beginPath(),i.strokeStyle="rgba(0, 0, 255, .8)",i.moveTo(o,0),i.lineTo(o+a,0),i.stroke(),i.closePath(),i.beginPath(),i.strokeStyle="rgba(173, 216, 230, .15)",i.moveTo(o,0),i.lineTo(o+a/3,0),i.stroke(),i.closePath()}i.restore()}(),I(),void P()},linear:function(){(function(){var n=0;i.fillStyle="rgba(173, 216, 230, .15)",y.getByteFrequencyData(b);for(var a=0;a<w;a++){var o=b[a];i.fillRect(n,.835*t.height-o,e,o),n+=e+1}})()},demo:function(){return function(){i.lineWidth=2,i.save(),i.translate(t.width/2,t.height/2),i.rotate(270*Math.PI/180);for(var e=0;e<150;e++)i.rotate(2*Math.PI/150),i.beginPath(),i.strokeStyle="rgba(0, 0, 255, .8)",i.moveTo(o,0),i.lineTo(o+10,0),i.stroke(),i.closePath(),i.beginPath(),i.strokeStyle="rgba(173, 216, 230, .15)",i.moveTo(o,0),i.lineTo(o+10/3,0),i.stroke(),i.closePath();i.restore()}(),I(),void P()},chaos:function(){return function(){i.fillStyle="red",i.strokeStyle="red",i.lineWidth=2,y.getByteFrequencyData(b),i.save(),i.translate(t.width/2,t.height/2);for(var e=0;e<w;e++){var n=b[e];n*=c?.5:.8;var a=e/(w/2)*Math.PI;i.beginPath(),i.rotate(2*Math.PI*a),i.moveTo(100,0),i.lineTo(100+n,0),i.stroke(),i.closePath()}i.restore()}(),void P()},concentric:function(){(function(){var e=.66*w-r;i.lineWidth=1,y.getByteFrequencyData(b);for(var n=0,a=r;a<e;a++){var o=b[a]<5?5:b[a];o*=c?.5:1,i.beginPath(),i.strokeStyle="rgba(0, 0, 255, .3)",i.beginPath(),i.arc(n,t.height/2,o,0,2*Math.PI),i.stroke(),i.closePath(),n+=t.width/(e-r)}})()}},g=["circular","linear","chaos","concentric"],m=[0,1,2,3],f=0,v=new(window.AudioContext||window.webkitAudioContext),y=v.createAnalyser();y.fftSize=1024;var w=y.frequencyBinCount,b=new Uint8Array(w),B=document.getElementById("audioElement");function k(){t.width=window.innerWidth,t.height=window.innerHeight-50,a=t.width/900,o=t.width>t.height?t.height/4:t.width/4,c=t.width>t.height?2*o+255>t.height:2*o+255>t.width,e=t.width/w,i.font="24px Arial",i.textAlign="center",i.textBaseline="middle"}function P(){i.lineWidth=1;var e=.3*o;i.font=e+"px Arial",i.fillStyle=2!==f?"rgba(173, 216, 230, .2)":"rgba(43, 16, 30, .2)";var n=u?L(B.currentTime):isNaN(B.duration)?"0:00":L(B.duration-B.currentTime);i.beginPath(),i.fillText(n,t.width/2,t.height/2)}function I(){var e=B.currentTime/B.duration*360;i.beginPath(),i.strokeStyle="rgba(255, 255, 255, .2)",i.arc(t.width/2,t.height/2,.55*o,0,2*Math.PI),i.stroke(),i.beginPath(),i.arc(t.width/2,t.height/2,.8*o,0,2*Math.PI),i.stroke(),i.beginPath(),i.strokeStyle="rgba(173, 216, 230, 0.05)",i.lineWidth=.25*o,i.arc(t.width/2,t.height/2,.675*o,0,e*(Math.PI/180)),i.stroke()}function E(){i.lineWidth=2;var e=a>1?30*a:40*a;i.font=e+"px Arial",i.fillStyle=2!==f?"rgba(177, 177, 177, .5)":"rgba(44, 44, 44, .5)",i.beginPath(),i.fillText(s,t.width/2,35)}function L(e){var t=Math.floor(e/60).toString(),i=Math.floor(e%60).toString();return t+":"+(i=1===i.length?"0"+i:i)}function S(){document.getElementById("audioVisualiserControls").classList.add("js-hidden"),document.getElementById("audioVisualiserOpenButton").classList.remove("js-hidden")}l="circular",v.createMediaElementSource(B).connect(y),y.connect(v.destination),k(),n.onchange=function(){var e,t=this.files;URL.revokeObjectURL(B.src),B.src=URL.createObjectURL(t[0]),e=t[0].name,s=e.slice(0,e.lastIndexOf(".")),B.load(),l="demo"===l?"circular":l,B.play()},function e(){i.clearRect(0,0,t.width,t.height),h[l](),E(),requestAnimationFrame(e)}(),window.addEventListener("resize",k),document.getElementById("audioVisualiserOpenButton").addEventListener("click",function(){this.classList.add("js-hidden"),document.getElementById("audioVisualiserControls").classList.remove("js-hidden")}),document.getElementById("audioVisualiserCloseButton").addEventListener("click",S),document.getElementById("audioVisualiserModeButton").addEventListener("click",function(){l=g[(g.indexOf(l)+1)%g.length]}),document.getElementById("audioVisualiserBackgroundButton").addEventListener("click",function(){document.getElementById("audioVisualiserBackground").classList.remove("audio-visualiser-bg-"+f),f=(f+1)%m.length,document.getElementById("audioVisualiserBackground").classList.add("audio-visualiser-bg-"+f)}),document.getElementById("audioVisualiserTimerButton").addEventListener("click",function(){u=!u}),document.addEventListener("click",function(e){return!document.getElementById("audioVisualiserControls").contains(e.target)&&S()},!0)}();