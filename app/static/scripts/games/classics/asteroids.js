!function(){"use strict";D();var t=document.getElementById("asteroidsMainCanvas"),e=t.getContext("2d");e.font="56px Arial";var i,n,r,s=document.getElementById("asteroidsBgCanvas"),a=s.getContext("2d"),o=(document.getElementById("rotateScreen"),document.getElementById("landingScreen")),h=(document.getElementById("playButton"),0),l=0,d=!1,u=!1,c=!1,v=1,y=3,f=0,g=1e3,m=!1,p=!1,x=!1,b=!1,w=[],T=window.localStorage,S=[{player:"AAA",score:5e5},{player:"CPU",score:3e5},{player:"JOE",score:1e5},{player:"JIM",score:25e3},{player:"SAL",score:5e3}],I=document.querySelectorAll(".asteroids-high-score"),E={x:t.width/2,y:t.height/2,width:80,height:50,thrust:4,drag:.01,vx:0,vy:0,maxVelocity:350,rotation:0,fireTimer:0,fireTime:.2,bullets:!1,isAlive:!0,isInvulnerable:!0,invulnerabilityTimer:0,invulnerabilityTime:3,collider:{x:t.width/2,y:t.height/2,radius:20}};function k(){this.x=0,this.y=0,this.radius=5,this.rotation=0,this.velocity=450,this.additionalVelocity=250}function A(){this.x=F(0,t.width),this.y=F(0,t.height),this.vx=q(-5,5),this.vy=q(-5,5),this.radius=100,this.splitsRemaining=2,this.numSides=F(5,9)}function M(){this.debrisAmount=50,this.debrisWidth=2,this.debrisHeight=2,this.debris=[],this.time=1.5,this.timer=0}function C(){this.active=[],this.pool=[],this.default={}}function P(){var t=2+v>10?10:2+v;E.bullets=new C,w=new C,r=new C;for(var e=0;e<60;e++)e<10&&E.bullets.pool.push(new k(0,0)),e<50&&r.pool.push(new M),e<60&&w.pool.push(new A);for(var i=0;i<t;i++)w.getNew()}function R(){0===w.active.length&&(v++,P(),E.x=t.width/2,E.y=t.height/2,E.vx=0,E.vy=0,E.isAlive=!0,E.isInvulnerable=!0,E.invulnerabilityTimer=0);for(var e=0;e<w.active.length;e++)if(w.active[e].update(),!E.isInvulnerable&&N(w.active[e],E.collider))return 0===y?(c=!0,void(f>n&&(T.setItem("asteroids",f),O()))):(y--,w.active[e].splitsRemaining>0&&L(w.active[e].x,w.active[e].y,w.active[e].radius/2,w.active[e].splitsRemaining-1),w.free(w.active[e]),E.isInvulnerable=!0,E.invulnerabilityTimer=0,B(E.x,E.y),E.x=t.width/2,E.y=t.height/2,E.vx=0,void(E.vy=0))}function B(t,e){var i=r.getNew();if(i){i.debris=[],i.timer=0;for(var n=0;n<i.debrisAmount;n++)i.debris.push({x:t,y:e,vx:q(-5,5),vy:q(-5,5)})}}function L(t,e,i,n){for(var r=0;r<3;r++){var s=w.getNew();s&&(s.x=t,s.y=e,s.radius=i,s.splitsRemaining=n)}}function N(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))<t.radius+e.radius}function F(t,e){return Math.floor(Math.random()*(e-t+1))+t}function q(t,e){return Math.random()*(e-t+1)+t}function D(){window.innerWidth<window.innerHeight?(rotateScreen.classList.remove("invaders-no-display"),u||(u=!0)):rotateScreen.classList.contains("invaders-no-display")||(rotateScreen.classList.add("invaders-no-display"),u&&(u=!1))}function O(){I.forEach(function(t,e){document.getElementById(t.dataset.player).innerText=S[S.length-1-e].player,document.getElementById(t.dataset.score).innerText=S[S.length-1-e].score})}k.prototype.update=function(){this.x+=Math.cos(this.rotation)*(this.velocity*l),this.y+=Math.sin(this.rotation)*(this.velocity*l)},k.prototype.render=function(){e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.fill()},A.prototype.update=function(){this.x+=this.vx,this.y+=this.vy,this.x+this.radius<0&&this.vx<0?this.x=t.width+this.radius:this.x-this.radius>t.width&&this.vx>0?this.x=-this.radius:this.y+this.radius<0&&this.vy<0?this.y=t.height+this.radius:this.y-this.radius>t.height&&this.vy>0&&(this.y=-this.radius)},A.prototype.render=function(){e.strokeStyle="rgba(222, 222, 222, 1)",e.lineWidth=2,e.beginPath(),e.moveTo(this.x+this.radius*Math.cos(0),this.y+this.radius*Math.sin(0));for(var t=1;t<=this.numSides;t++)e.lineTo(this.x+this.radius*Math.cos(2*t*Math.PI/this.numSides),this.y+this.radius*Math.sin(2*t*Math.PI/this.numSides));e.stroke()},M.prototype.render=function(){e.fillStyle="rgba(222, 222, 222, 1)";for(var t=0;t<this.debris.length;t++)e.beginPath(),e.fillRect(this.debris[t].x,this.debris[t].y,this.debrisWidth,this.debrisHeight)},M.prototype.update=function(){this.timer+=l;for(var t=0;t<this.debris.length;t++)this.debris[t].x+=this.debris[t].vx,this.debris[t].y+=this.debris[t].vy},C.prototype.setDefaults=function(t){this.default=t.defaults},C.prototype.getNew=function(){if(this.pool.length>0){var t=this.pool.pop();return this.active.push(t),t}return!1},C.prototype.free=function(t){var e=this.active.indexOf(t);this.active.splice(e,1),this.pool.push(t)},a.clearRect(0,0,s.width,s.height),a.beginPath(),a.fillStyle="#000000",a.fillRect(0,0,t.width,t.height),function(){i=[];for(var e=0;e<g;e++)i.push({x:F(0,t.width),y:F(0,t.height),size:1})}(),function(){for(var t=0;t<i.length;t++){var e=i[t];a.beginPath(),a.shadowBlur=Math.floor(5*Math.random()+2),a.shadowColor="white",a.fillStyle="rgba(255, 255, 255,"+Math.random()+")",a.fillRect(e.x,e.y,e.size,e.size),a.closePath()}}(),P(),function(){if(null!==(n=T.getItem("asteroids"))){n=parseInt(n);var t=!1;S.reverse().forEach(function(e,i){n>e.score&&(t=i)}),!1!==t&&(S[t].player="YOU",S[t].score=n)}}(),O(),requestAnimationFrame(function i(n){var s;l=(s=n)-h<250?(s-h)/1e3:.0167,h=s,u||c||!d||(e.clearRect(0,0,t.width,t.height),function(){if(E.isInvulnerable&&(E.invulnerabilityTimer+=l,E.invulnerabilityTimer>=E.invulnerabilityTime&&(E.isInvulnerable=!1)),E.fireTimer+=l,E.x+=E.vx,E.y+=E.vy,m?(E.rotation-=.05,E.rotation>=360&&(E.rotation=0)):p&&(E.rotation+=.05,E.rotation<=-360&&(E.rotation=0)),x&&(E.vx+=Math.cos(E.rotation)*(E.thrust*l),E.vy+=Math.sin(E.rotation)*(E.thrust*l)),E.vx-=E.vx>0?E.drag:-E.drag,E.vy-=E.vy>0?E.drag:-E.drag,b&&E.fireTimer>=E.fireTime){var t=E.bullets.getNew();t&&(E.fireTimer=0,t.x=E.x,t.y=E.y,t.rotation=E.rotation)}E.collider.x=E.x,E.collider.y=E.y}(),function(){for(var e=E.bullets.active.length-1;e>=0;e--){if(E.bullets.active[e].update(),E.bullets.active[e].y+E.bullets.active[e].radius<0||E.bullets.active[e].y>t.height||E.bullets.active[e].x+E.bullets.active[e].radius<0||E.bullets.active[e].x>t.width)return void E.bullets.free(E.bullets.active[e]);for(var i=w.active.length-1;i>=0;i--)if(N(E.bullets.active[e],w.active[i]))return E.bullets.free(E.bullets.active[e]),f+=2===w.active[i].splitsRemaining?100:1===w.active[i].splitsRemaining?200:100,w.active[i].splitsRemaining>0&&L(w.active[i].x,w.active[i].y,w.active[i].radius/2,w.active[i].splitsRemaining-1),B(w.active[i].x,w.active[i].y),void w.free(w.active[i])}}(),R(),r.active.forEach(function(t){t.update(),t.timer>t.time&&r.free(t)}),E.x-E.width/2<0?E.x=E.width/2:E.x+E.width/2>t.width?E.x=t.width-E.width/2:E.y-E.width/2<0?E.y=E.width/2:E.y+E.width/2>t.height&&(E.y=t.height-E.width/2),e.fillStyle="rgba(222, 222, 222, 1)",E.bullets.active.forEach(function(t){t.render()}),w.active.forEach(function(t){t.render()}),e.save(),e.translate(E.x,E.y),e.rotate(E.rotation),E.isInvulnerable&&1&parseInt(E.invulnerabilityTimer.toFixed(1).slice(-1))?e.strokeStyle="#999":e.strokeStyle="#FFF",e.lineWidth=2,e.beginPath(),e.moveTo(-E.width/2,-E.height/2),e.lineTo(-E.width/4,-E.height/2.8),e.lineTo(-E.width/4,E.height/2.8),e.moveTo(-E.width/4,-E.height/2.8),e.lineTo(E.width/2,0),e.lineTo(-E.width/2,E.height/2),x&&(e.moveTo(.375*-E.width,-E.height/5),e.lineTo(.375*-E.width,E.height/5),e.lineTo(.6875*-E.width,0),e.lineTo(.375*-E.width,-E.height/5),e.stroke()),e.stroke(),e.restore(),r.active.forEach(function(t){t.render()})),e.textAlign="left",e.fillStyle="rgba(222, 222, 222, 1)",e.beginPath(),e.fillText("Level: "+v,20,t.height-20),e.textAlign="right",e.beginPath(),e.fillText("Credits: "+y,t.width-20,t.height-20),e.textAlign="center",e.beginPath(),e.fillText("Score: "+f,t.width/2,60),u&&(e.fillStyle="green",e.textAlign="center",e.beginPath(),e.fillText("Paused",t.width/2,t.height/2)),c&&(e.fillStyle="red",e.textAlign="center",e.beginPath(),e.fillText("GAME OVER",t.width/2,t.height/2),e.fillStyle="rgba(222, 222, 222, 1)",e.fillText("Press space or touch to play again",t.width/2,t.height/2+75)),requestAnimationFrame(i)}),document.addEventListener("keydown",function(e){37===e.keyCode?m=!0:39===e.keyCode?p=!0:38===e.keyCode?(e.preventDefault(),x=!0):40===e.keyCode?(e.preventDefault(),!0):32===e.keyCode?(e.preventDefault(),c?(c=!1,P(),y=4,v=1,c=!1,f=0,E.x=t.width/2,E.y=t.height/2,E.vx=0,E.vy=0,E.isAlive=!0,E.isInvulnerable=!0,E.invulnerabilityTimer=0):b=!0):80===e.keyCode&&(u=!u)}),document.addEventListener("keyup",function(t){37===t.keyCode?m=!1:39===t.keyCode?p=!1:38===t.keyCode?x=!1:40===t.keyCode?!1:32===t.keyCode&&(b=!1)}),t.addEventListener("touchstart",function(e){"BUTTON"!==e.target.nodeName&&"A"!==e.target.nodeName&&e.preventDefault(),e.touches[0].clientY<=t.width/2?m=!0:p=!0,b=!0},!0),t.addEventListener("touchend",function(t){"BUTTON"!==t.target.nodeName&&"A"!==t.target.nodeName&&t.preventDefault(),m=!1,p=!1,b=!1},!0),window.addEventListener("resize",D),document.getElementById("playButton").addEventListener("click",function(){d=!0,o.classList.add("invaders-no-display");var t=document.getElementById("fullScreenWrapper"),e=t.requestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen;try{e.call(t)}catch(t){console.log("no full screen")}})}();