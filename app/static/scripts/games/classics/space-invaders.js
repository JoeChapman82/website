!function(){"use strict";J();var e=document.getElementById("invadersMainCanvas"),t=e.getContext("2d");t.font="56px Arial";var i,n=document.getElementById("invadersBgCanvas"),h=n.getContext("2d"),s=(document.getElementById("rotateScreen"),document.getElementById("landingScreen")),a=(document.getElementById("playButton"),0),r=0,o=!1,c=!1,d=!1,l=1,g=4,f=0,p=1e3,v=!1,u=!1,y=[],w=[],m=new Image,x={"1-1":new Image,"1-2":new Image,"2-1":new Image,"2-2":new Image,"3-1":new Image,"3-2":new Image,special:new Image};x["1-1"].src="/images/games/classics/space-invaders/invader-1-1.png",x["1-2"].src="/images/games/classics/space-invaders/invader-1-2.png",x["2-1"].src="/images/games/classics/space-invaders/invader-2-1.png",x["2-2"].src="/images/games/classics/space-invaders/invader-2-2.png",x["3-1"].src="/images/games/classics/space-invaders/invader-3-1.png",x["3-2"].src="/images/games/classics/space-invaders/invader-3-2.png",x.special.src="/images/games/classics/space-invaders/invaderSpecial.png",m.src="/images/games/classics/space-invaders/cannon.png";var E,T,A,b=1,S={initialOffset:200,widths:[50,70,90],height:50,movementX:25,movementY:35,rows:5,perRow:11,movingForward:!0,spacingX:60,spacingY:30,initialFireChance:1e-4,fireChance:1e-4},C=.85,I=.85,P=0,k=10,B=0,F=!1,L=!1,N=.25,R=0,M={x:300,y:e.height-55,width:150,height:30,vx:250},q={x:e.width,y:50,width:125,height:40,vx:4,isAlive:!0};function O(e,t){this.x=e,this.y=t,this.width=5,this.height=15,this.vy=10}function Y(e,t){this.x=e,this.y=t,this.width=5,this.height=35,this.vy=5}function z(){this.x=0,this.y=0,this.width=40,this.height=40,this.timer=.2}function X(){this.active=[],this.pool=[],this.default={}}function D(){E=new X,T=new X;for(var e=0;e<3;e++)E.pool.push(new O(0,0));for(var t=0;t<100;t++)T.pool.push(new Y(0,0))}function W(){A=new X;for(var e=0;e<50;e++)A.pool.push(new z)}function U(){I=C,P=0,G(),H(),D(),W()}function G(){y=[];for(var e=1;e<=S.rows;e++)for(var t=1;t<=S.perRow;t++){var i=1===e?10:2===e||3===e?0:-10;y.push({x:t*(S.widths[1]+S.spacingX)-S.widths[1]+S.initialOffset+i,y:e*(S.height+S.spacingY-S.spacingY+30),width:S.widths[1===e?0:2===e||3===e?1:2],height:S.height,type:1===e?"1":2===e||3===e?"2":"3",isAlive:!0})}}function H(){w=[];for(var t=0;t<4;t++)w.push({x:200+200*t+230*t,y:e.height-250,width:220,height:130,pieces:[]});w.forEach(function(e){for(var t=0;t<5;t++)for(var i=0;i<4;i++)e.pieces.push({x:e.x+t*(e.width/5),y:e.y+i*(e.height/4),width:e.width/5,height:e.height/4+2,hitpoints:3})})}function V(e,t){return t.x+t.width>=e.x&&t.x<=e.x+e.width&&t.y+t.height>=e.y&&t.y<=e.y+e.height}function j(e,t){return Math.random()*(t-e)+e}function J(){window.innerWidth<window.innerHeight?(rotateScreen.classList.remove("invaders-no-display"),c||(c=!0)):rotateScreen.classList.contains("invaders-no-display")||(rotateScreen.classList.add("invaders-no-display"),c&&(c=!1))}O.prototype.update=function(){this.y-=this.vy},O.prototype.render=function(){t.fillStyle="green",t.beginPath(),t.fillRect(this.x,this.y,this.width,this.height),t.fill()},Y.prototype.update=function(){this.y+=this.vy},Y.prototype.render=function(){t.beginPath(),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x+this.width,this.y+this.height/4),t.lineTo(this.x,this.y+this.height/4*2),t.lineTo(this.x+this.width,this.y+this.height/4*3),t.lineTo(this.x+this.width/2,this.y+this.height),t.stroke()},z.prototype.render=function(){t.strokeStyle="rgba(166, 166, 166, 1)",t.moveTo(this.x,this.y+this.height/2),t.lineTo(this.x+this.width,this.y+this.height/2),t.moveTo(this.x+this.width/2,this.y),t.lineTo(this.x+this.width/2,this.y+this.height),t.moveTo(this.x,this.y),t.lineTo(this.x+this.width,this.y+this.height),t.moveTo(this.x+this.width,this.y),t.lineTo(this.x,this.y+this.height),t.stroke()},z.prototype.update=function(){this.timer-=r},X.prototype.setDefaults=function(e){this.default=e.defaults},X.prototype.getNew=function(){if(this.pool.length>0){var e=this.pool.pop();return this.active.push(e),e}return!1},X.prototype.free=function(e){var t=this.active.indexOf(e);this.active.splice(t,1),this.pool.push(e)},h.clearRect(0,0,n.width,n.height),h.beginPath(),h.fillStyle="#000000",h.fillRect(0,0,e.width,e.height),function(){i=[];for(var t=0;t<p;t++)i.push({x:j(0,e.width),y:j(0,e.height),size:1})}(),function(){for(var e=0;e<i.length;e++){var t=i[e];h.beginPath(),h.shadowBlur=Math.floor(5*Math.random()+2),h.shadowColor="white",h.fillStyle="rgba(255, 255, 255,"+Math.random()+")",h.fillRect(t.x,t.y,t.size,t.size),h.closePath()}}(),G(),H(),D(),W(),requestAnimationFrame(function i(n){var h,s,p;r=(h=n)-a<250?(h-a)/1e3:.0167,a=h,c||d||!o||(t.clearRect(0,0,e.width,e.height),function(){if(M.x+=v?-Math.floor(M.vx*r):u?Math.floor(M.vx*r):0,R+=r,L&&R>=N){var e=E.getNew();!1!==e&&(R=0,e.x=M.x+M.width/2-e.width/2,e.y=M.y)}}(),function(){var t=!1,i=!1;if((P+=r)>=I&&(P=0,i=!0),i){b++;var n,h=!1;y.forEach(function(i){if(i.isAlive){i.x+=S.movingForward?S.movementX:-S.movementX,i.x<=0?(n=i.x,h=!0):i.x+i.width>=e.width&&(n=i.x+i.width-e.width,h=!0),(V(M,i)||i.y+i.height>e.height)&&(t=!0);for(var s=0;s<w.length;s++)for(var a=0;a<w[s].pieces.length;a++)w[s].pieces[a].hitpoints>0&&V(i,w[s].pieces[a])&&(w[s].pieces[a].hitpoints=0)}}),h&&(y.forEach(function(e){e.x-=n,e.y+=S.movementY}),S.movingForward=!S.movingForward)}y.forEach(function(e){if(e.isAlive&&Math.random()<S.fireChance){var t=T.getNew();!1!==t&&(t.x=e.x+e.width/2,t.y=e.y+e.height)}}),t&&(g>0?(g--,U()):d=!0),F?(q.x-=q.vx,(q.x+q.width<0||!q.isAlive)&&(q.x=e.width,F=!1,B=0,q.isAlive=!0)):(B+=r)>=k&&(F=!0)}(),E.active.forEach(function(e){e.update(),e.y+e.height<0&&E.free(e);for(var t=0;t<y.length;t++)if(y[t].isAlive&&V(e,y[t])){E.free(e),y[t].isAlive=!1,f+="1"===y[t].type?300:"2"===y[t].type?200:100,I-=.015;var i=A.getNew();return void(!1!==i&&(i.x=y[t].x+y[t].width/4,i.y=y[t].y+y[t].height/4,i.timer=.2))}if(V(e,q)){q.isAlive=!1,f+=1e3;var n=A.getNew();!1!==n&&(n.x=q.x+q.width/2,n.y=q.y,n.timer=.2)}w.forEach(function(t){for(var i=0;i<t.pieces.length;i++)if(t.pieces[i].hitpoints>0&&V(e,t.pieces[i]))return t.pieces[i].hitpoints=0,void E.free(e)})}),p=!1,T.active.forEach(function(t){t.update(),t.y>e.height?T.free(t):V(t,M)&&(T.free(t),p=!0),w.forEach(function(e){for(var i=0;i<e.pieces.length;i++)if(e.pieces[i].hitpoints>0&&V(t,e.pieces[i]))return e.pieces[i].hitpoints--,void T.free(t)})}),p&&(g>0?(g--,U()):d=!0),A.active.forEach(function(e){e.update(),e.timer<0&&A.free(e)}),M.x<0?M.x=0:M.x+M.width>e.width&&(M.x=e.width-M.width),E.active.forEach(function(e){e.render()}),t.beginPath(),t.drawImage(m,M.x,M.y-20,M.width,M.height+20),w.forEach(function(e){e.pieces.forEach(function(e){e.hitpoints>0&&(t.fillStyle=3===e.hitpoints?"rgba(188, 188, 188, 1)":e.hitpoints>=2?"rgba(144, 144, 144, 1)":"rgba(102, 102, 102, 1)",t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.fill())})}),A.active.forEach(function(e){e.render()}),t.strokeStyle="red",t.lineWidth=4,T.active.forEach(function(e){e.render()}),y.forEach(function(e,i){e.isAlive&&(t.beginPath(),b%2==0?t.drawImage(x[e.type+"-1"],e.x,e.y,e.width,e.height):t.drawImage(x[e.type+"-2"],e.x,e.y,e.width,e.height))}),t.beginPath(),t.drawImage(x.special,q.x,q.y,q.width,q.height),s=!0,y.forEach(function(e){e.isAlive&&(s=!1)}),s&&("1"===(++l).toString().slice(-1)?S.fireChance=S.initialFireChance:S.fireChance+=2e-4,U())),t.textAlign="left",t.fillStyle="rgba(222, 222, 222, 1)",t.beginPath(),t.fillText("Level: "+l,20,e.height-20),t.textAlign="right",t.beginPath(),t.fillText("Credits: "+g,e.width-20,e.height-20),t.textAlign="center",t.beginPath(),t.fillText("Score: "+f,e.width/2,60),c&&(t.fillStyle="green",t.textAlign="center",t.beginPath(),t.fillText("Paused",e.width/2,e.height/2)),d&&(t.fillStyle="red",t.textAlign="center",t.beginPath(),t.fillText("GAME OVER",e.width/2,e.height/2),t.fillStyle="rgba(222, 222, 222, 1)",t.fillText("Press space or touch to play again",e.width/2,e.height/2+75)),requestAnimationFrame(i)}),document.addEventListener("keydown",function(e){37===e.keyCode?v=!0:39===e.keyCode?u=!0:32===e.keyCode?(e.preventDefault(),d?(G(),H(),D(),W(),g=3,l=1,d=!1,f=0):L=!0):80===e.keyCode&&(c=!c)}),document.addEventListener("keyup",function(e){37===e.keyCode?v=!1:39===e.keyCode?u=!1:32===e.keyCode&&(L=!1)}),e.addEventListener("touchstart",function(t){"BUTTON"!==t.target.nodeName&&"A"!==t.target.nodeName&&t.preventDefault(),t.touches[0].clientY<=e.width/2?v=!0:u=!0,L=!0},!0),e.addEventListener("touchend",function(e){"BUTTON"!==e.target.nodeName&&"A"!==e.target.nodeName&&e.preventDefault(),v=!1,u=!1,L=!1},!0),window.addEventListener("resize",J),document.getElementById("playButton").addEventListener("click",function(){o=!0,s.classList.add("invaders-no-display");var e=document.getElementById("fullScreenWrapper"),t=e.requestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;try{t.call(e)}catch(e){console.log("no full screen")}})}();